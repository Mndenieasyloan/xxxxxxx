<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mining Tracks - V0 Trade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: rgb(203 213 225);
            border-radius: 0.5rem;
            transition: all 0.2s;
        }
        .sidebar-link:hover {
            background-color: rgb(168 85 247 / 0.1);
            color: rgb(168 85 247);
        }
        .sidebar-link.active {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(236, 72, 153, 0.2));
            color: rgb(168 85 247);
            font-weight: 600;
        }
        
        /* Updated mobile sidebar behavior to use toggle button instead of hover */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                height: 100vh;
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
                z-index: 40;
                width: 240px;
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .sidebar-overlay {
                display: none;
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 30;
            }
            .sidebar-overlay.active {
                display: block;
            }
            .sidebar-toggle {
                display: flex;
            }
        }
        
        @media (min-width: 769px) {
            .sidebar-toggle {
                display: none;
            }
        }
        
        .mobile-menu { display: none; }
        .mobile-menu.active { display: block; }
        .dropdown { position: relative; display: inline-block; }
        .dropdown-content { display: none; position: absolute; background-color: rgb(15 23 42 / 0.95); min-width: 12rem; border: 1px solid rgb(168 85 247 / 0.2); border-radius: 0.5rem; padding: 0.5rem; z-index: 1000; backdrop-filter: blur(10px); }
        .dropdown:hover .dropdown-content { display: block; }
        
        /* Custom styles for mining tracking */
        .mining-card {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(236, 72, 153, 0.1));
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 1rem;
            transition: all 0.3s ease;
        }
        
        .mining-card:hover {
            border-color: rgba(168, 85, 247, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(168, 85, 247, 0.1);
        }
        
        .progress-bar {
            height: 8px;
            background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6);
            border-radius: 4px;
            animation: progressAnimation 2s ease-in-out infinite alternate;
        }
        
        @keyframes progressAnimation {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .coin-animation {
            animation: coinSpin 3s linear infinite;
        }
        
        @keyframes coinSpin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }
        
        .glowing-border {
            border: 2px solid transparent;
            background: linear-gradient(45deg, #f59e0b, #ef4444, #8b5cf6) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
        }
        
        .chart-container {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            border: 1px solid rgba(168, 85, 247, 0.2);
        }
    </style>
</head>
<body class="bg-slate-950">
    
    <!-- Added hamburger toggle button for mobile -->
    <button onclick="toggleSidebar()" class="sidebar-toggle fixed left-4 top-20 z-50 bg-purple-500 hover:bg-purple-600 text-white p-2 rounded-lg shadow-lg transition">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
    </button>
    
    <!-- Added overlay for mobile sidebar -->
    <div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>
    
    <header class="sticky top-0 z-50 border-b border-purple-500/20 bg-slate-950/80 backdrop-blur-md">
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between py-4">
                <a href="index.html" class="flex items-center gap-2 hover:opacity-80 transition">
                    <div class="h-10 w-10">
                        <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" class="w-full h-full">
                            <defs>
                                <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color: #a78bfa; stop-opacity: 1" />
                                    <stop offset="50%" style="stop-color: #ec4899; stop-opacity: 1" />
                                    <stop offset="100%" style="stop-color: #06b6d4; stop-opacity: 1" />
                                </linearGradient>
                            </defs>
                            <circle cx="100" cy="100" r="95" fill="url(#logoGradient)" opacity="0.2" />
                            <circle cx="100" cy="100" r="90" fill="none" stroke="url(#logoGradient)" stroke-width="2" />
                            <path d="M 50 60 L 80 140 M 150 60 L 120 140" stroke="url(#logoGradient)" stroke-width="8" stroke-linecap="round" fill="none" />
                            <circle cx="100" cy="100" r="25" fill="none" stroke="url(#logoGradient)" stroke-width="6" />
                        </svg>
                    </div>
                    <span class="text-xl font-bold bg-gradient-to-r from-purple-400 via-pink-400 to-cyan-400 bg-clip-text text-transparent">V0 Trade</span>
                </a>

                <nav class="hidden items-center gap-8 md:flex">
                    <a href="index.html" class="text-sm text-gray-300 hover:text-white transition">Home</a>
                    <div class="dropdown">
                        <button class="text-sm text-gray-300 hover:text-white transition flex items-center gap-1">Invest <span>‚ñº</span></button>
                        <div class="dropdown-content">
                            <a href="cryptocurrencies.html" class="block px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-purple-500/10 rounded">Cryptocurrencies</a>
                            <a href="precious-metals.html" class="block px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-purple-500/10 rounded">Precious Metals</a>
                            <a href="stocks.html" class="block px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-purple-500/10 rounded">Stocks</a>
                            <a href="etfs.html" class="block px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-purple-500/10 rounded">ETFs</a>
                        </div>
                    </div>
                    <a href="btc-miner.html" class="text-sm text-gray-300 hover:text-white transition">BTC Miner</a>
                    <a href="about.html" class="text-sm text-gray-300 hover:text-white transition">About</a>
                    <a href="security.html" class="text-sm text-gray-300 hover:text-white transition">Security</a>
                    <div class="dropdown">
                        <button class="text-sm text-gray-300 hover:text-white transition flex items-center gap-1">Support <span>‚ñº</span></button>
                        <div class="dropdown-content">
                            <a href="contact.html" class="block px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-purple-500/10 rounded">Contact Support</a>
                            <a href="faq.html" class="block px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-purple-500/10 rounded">FAQ</a>
                        </div>
                    </div>
                </nav>

                <div class="hidden items-center gap-4 md:flex">
                    <a href="dashboard.html" class="text-sm text-purple-400 hover:text-purple-300 transition">Dashboard</a>
                    <span class="text-sm text-gray-400" id="userEmailDisplay">user@email.com</span>
                    <a href="index.html" class="text-sm text-gray-300 hover:text-white transition">Logout</a>
                </div>

                <button class="md:hidden" onclick="toggleMobileMenu()">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
            </div>

            <div id="mobileMenu" class="mobile-menu border-t border-purple-500/20 py-4 md:hidden">
                <nav class="flex flex-col gap-3">
                    <a href="index.html" class="text-sm text-gray-300 hover:text-white">Home</a>
                    <a href="cryptocurrencies.html" class="text-sm text-gray-300 hover:text-white">Cryptocurrencies</a>
                    <a href="precious-metals.html" class="text-sm text-gray-300 hover:text-white">Precious Metals</a>
                    <a href="stocks.html" class="text-sm text-gray-300 hover:text-white">Stocks</a>
                    <a href="etfs.html" class="text-sm text-gray-300 hover:text-white">ETFs</a>
                    <a href="btc-miner.html" class="text-sm text-gray-300 hover:text-white">BTC Miner</a>
                    <a href="about.html" class="text-sm text-gray-300 hover:text-white">About</a>
                    <a href="security.html" class="text-sm text-gray-300 hover:text-white">Security</a>
                    <a href="contact.html" class="text-sm text-gray-300 hover:text-white">Contact</a>
                    <a href="faq.html" class="text-sm text-gray-300 hover:text-white">FAQ</a>
                    <a href="dashboard.html" class="text-sm text-purple-400 hover:text-purple-300">Dashboard</a>
                    <a href="index.html" class="text-sm text-gray-300 hover:text-white">Logout</a>
                </nav>
            </div>
        </div>
    </header>

    <div class="flex min-h-screen">
        <!-- Added id attribute for mobile toggle functionality -->
        <aside id="sidebar" class="sidebar w-64 bg-slate-900/50 border-r border-purple-500/20 p-4 backdrop-blur-sm">
            <div class="space-y-1 mb-6">
                <a href="deposit.html" class="sidebar-link">
                    <span>üí∞</span>
                    <span class="sidebar-text">Deposit</span>
                </a>
                <a href="withdraw.html" class="sidebar-link">
                    <span>üí∏</span>
                    <span class="sidebar-text">Withdraw</span>
                </a>
            </div>
            
            <div class="mb-6">
                <a href="dashboard.html" class="sidebar-link">
                    <span>üìä</span>
                    <span class="sidebar-text">Dashboard</span>
                </a>
                <a href="coin-wallets.html" class="sidebar-link">
                    <span>ü™ô</span>
                    <span class="sidebar-text">Coin Wallets</span>
                </a>
                <a href="mining-tracks.html" class="sidebar-link active">
                    <span>‚õèÔ∏è</span>
                    <span class="sidebar-text">Mining Tracks</span>
                </a>
                <a href="investment-tracks.html" class="sidebar-link">
                    <span>üìà</span>
                    <span class="sidebar-text">Investment Tracks</span>
                </a>
            </div>

            <div class="mb-2">
                <p class="text-xs font-semibold text-gray-500 uppercase px-4 mb-2 sidebar-text">Report</p>
                <a href="referral-commissions.html" class="sidebar-link">
                    <span>üéÅ</span>
                    <span class="sidebar-text">Ref. Commissions</span>
                </a>
                <a href="deposit-history.html" class="sidebar-link">
                    <span>üì•</span>
                    <span class="sidebar-text">Deposit History</span>
                </a>
                <a href="order-history.html" class="sidebar-link">
                    <span>üìã</span>
                    <span class="sidebar-text">Order History</span>
                </a>
                <a href="withdrawals-log.html" class="sidebar-link">
                    <span>üì§</span>
                    <span class="sidebar-text">Withdrawals Log</span>
                </a>
                <a href="transactions.html" class="sidebar-link">
                    <span>üí≥</span>
                    <span class="sidebar-text">Transactions</span>
                </a>
            </div>

            <div>
                <p class="text-xs font-semibold text-gray-500 uppercase px-4 mb-2 sidebar-text">Support</p>
                <a href="open-ticket.html" class="sidebar-link">
                    <span>üé´</span>
                    <span class="sidebar-text">Open New Ticket</span>
                </a>
                <a href="support-tickets.html" class="sidebar-link">
                    <span>üì®</span>
                    <span class="sidebar-text">Support Tickets</span>
                </a>
            </div>
        </aside>

        <main class="flex-1 p-4 md:p-8 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950">
            <div class="max-w-7xl mx-auto">
                <!-- Page Header -->
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-white mb-2">BTC Mining Tracks</h1>
                        <p class="text-gray-400">Track your Bitcoin mining investments and earnings in real-time</p>
                    </div>
                    <button onclick="refreshMiningData()" class="mt-4 md:mt-0 flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-lg font-medium transition">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        Refresh Data
                    </button>
                </div>

                <!-- Mining Stats Summary -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="mining-card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-400 mb-1">Total Mining Investment</p>
                                <p id="totalInvestment" class="text-2xl font-bold text-white">$0.00</p>
                            </div>
                            <div class="text-3xl coin-animation">‚Çø</div>
                        </div>
                        <div class="mt-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-400">Active Plans</span>
                                <span id="activePlansCount" class="text-green-400">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="mining-card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-400 mb-1">Total Mining Earnings</p>
                                <p id="totalEarnings" class="text-2xl font-bold text-white">$0.00</p>
                            </div>
                            <div class="text-3xl text-yellow-400">üí∞</div>
                        </div>
                        <div class="mt-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-400">Daily Average</span>
                                <span id="dailyAverage" class="text-green-400">$0.00</span>
                            </div>
                        </div>
                    </div>

                    <div class="mining-card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-400 mb-1">Total Days Mining</p>
                                <p id="totalDays" class="text-2xl font-bold text-white">0</p>
                            </div>
                            <div class="text-3xl pulse">‚è±Ô∏è</div>
                        </div>
                        <div class="mt-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-400">Remaining Days</span>
                                <span id="remainingDays" class="text-blue-400">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Earnings Line Chart -->
                    <div class="chart-container p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Mining Earnings Trend</h3>
                        <div class="h-64">
                            <canvas id="earningsChart"></canvas>
                        </div>
                    </div>

                    <!-- Mining Distribution Pie Chart -->
                    <div class="chart-container p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Mining Plan Distribution</h3>
                        <div class="h-64">
                            <canvas id="distributionChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Active Mining Tracks -->
                <div class="mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-white">Active Mining Plans</h2>
                        <a href="btc-miner.html" class="text-sm bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 text-white px-4 py-2 rounded-lg font-medium transition">
                            + Add Mining Plan
                        </a>
                    </div>

                    <div id="miningPlansContainer">
                        <!-- Mining plans will be loaded here -->
                        <div class="mining-card p-6 text-center">
                            <div class="text-5xl mb-4">‚õèÔ∏è</div>
                            <h3 class="text-xl font-semibold text-white mb-3">No Active Mining Plans</h3>
                            <p class="text-gray-400 mb-6">Start mining Bitcoin today with our AI-powered cloud mining platform</p>
                            <a href="btc-miner.html" class="inline-block bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 text-white px-6 py-3 rounded-lg font-semibold transition">
                                Browse Mining Plans
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Candlestick Chart for Mining Performance -->
                <div class="chart-container p-6 mb-8">
                    <h3 class="text-lg font-semibold text-white mb-4">Daily Mining Performance</h3>
                    <div class="h-80">
                        <canvas id="candlestickChart"></canvas>
                    </div>
                </div>

                <!-- Mining Transactions History -->
                <div class="chart-container p-6">
                    <h3 class="text-lg font-semibold text-white mb-4">Mining Transactions</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-700">
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-400">Date</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-400">Plan</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-400">Investment</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-400">Duration</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-400">Status</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-400">Daily Return</th>
                                </tr>
                            </thead>
                            <tbody id="miningTransactionsList">
                                <tr>
                                    <td colspan="6" class="text-center py-12">
                                        <p class="text-gray-500">Loading mining transactions...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Constants for localStorage keys (must match dashboard)
        const TRANSACTIONS_DATA_KEY = "v0trade_transactions_data";
        
        // Chart instances
        let earningsChart = null;
        let distributionChart = null;
        let candlestickChart = null;
        
        window.addEventListener('DOMContentLoaded', function() {
            const userEmail = localStorage.getItem("v0trade_user_email");
            
            if (!userEmail) {
                alert("Please login to access this page.");
                window.location.href = "login.html";
                return;
            }

            // Update header with user email
            const emailDisplay = document.getElementById('userEmailDisplay');
            if (emailDisplay) {
                emailDisplay.textContent = userEmail;
            }
            
            // Load mining data
            loadMiningData(userEmail);
        });

        function loadMiningData(email) {
            try {
                // Get cached transactions from localStorage
                const cachedData = localStorage.getItem(`${TRANSACTIONS_DATA_KEY}_${email}`);
                
                if (!cachedData) {
                    displayNoMiningPlans();
                    return;
                }
                
                const allTransactions = JSON.parse(cachedData);
                
                // Filter to get only mining/investment transactions
                const miningTransactions = allTransactions.filter(transaction => {
                    const type = transaction.type?.toLowerCase() || '';
                    const method = transaction.method?.toLowerCase() || '';
                    
                    // Look for mining-related transactions
                    return type.includes('investment') || 
                           type.includes('mining') || 
                           method.includes('btc') ||
                           method.includes('mining') ||
                           method.includes('crypto');
                });
                
                console.log("Mining transactions found:", miningTransactions);
                
                if (miningTransactions.length === 0) {
                    displayNoMiningPlans();
                    return;
                }
                
                // Process mining transactions into mining plans
                const miningPlans = processMiningPlans(miningTransactions);
                
                // Display mining plans
                displayMiningPlans(miningPlans);
                
                // Display mining transactions
                displayMiningTransactions(miningTransactions);
                
                // Update summary statistics
                updateMiningStats(miningPlans, miningTransactions);
                
                // Initialize charts
                initializeCharts(miningPlans, miningTransactions);
                
            } catch (err) {
                console.error("Error loading mining data:", err);
                displayNoMiningPlans();
            }
        }
        
        function processMiningPlans(transactions) {
            const miningPlans = [];
            
            transactions.forEach(transaction => {
                const amount = parseFloat(transaction.amount) || 0;
                const method = transaction.method || '';
                
                // Extract duration from method field (e.g., "BTC Miner 30 days")
                let duration = 30; // Default duration
                const durationMatch = method.match(/\d+/);
                if (durationMatch) {
                    duration = parseInt(durationMatch[0]);
                }
                
                // Calculate days passed since transaction
                const transactionDate = new Date(transaction.date);
                const now = new Date();
                const daysPassed = Math.floor((now - transactionDate) / (1000 * 60 * 60 * 24));
                const daysRemaining = Math.max(0, duration - daysPassed);
                
                // Calculate progress percentage
                const progressPercentage = Math.min(100, (daysPassed / duration) * 100);
                
                // Calculate earnings (simulated based on investment amount)
                const dailyReturnRate = 0.02; // 2% daily return for simulation
                const totalEarnings = amount * dailyReturnRate * daysPassed;
                const dailyEarnings = amount * dailyReturnRate;
                
                miningPlans.push({
                    id: transaction.id,
                    name: method || 'BTC Mining Plan',
                    amount: amount,
                    duration: duration,
                    startDate: transaction.date,
                    daysPassed: daysPassed,
                    daysRemaining: daysRemaining,
                    progress: progressPercentage,
                    totalEarnings: totalEarnings,
                    dailyEarnings: dailyEarnings,
                    status: daysRemaining > 0 ? 'Active' : 'Completed',
                    method: transaction.method || 'Cloud Mining'
                });
            });
            
            return miningPlans;
        }
        
        function displayMiningPlans(miningPlans) {
            const container = document.getElementById('miningPlansContainer');
            
            if (miningPlans.length === 0) {
                displayNoMiningPlans();
                return;
            }
            
            container.innerHTML = '';
            
            // Sort by status (active first) and then by amount (largest first)
            miningPlans.sort((a, b) => {
                if (a.status === 'Active' && b.status !== 'Active') return -1;
                if (a.status !== 'Active' && b.status === 'Active') return 1;
                return b.amount - a.amount;
            });
            
            miningPlans.forEach(plan => {
                const planCard = document.createElement('div');
                planCard.className = 'mining-card p-6 mb-4';
                
                // Determine status color
                let statusColor = 'text-green-400';
                let statusBg = 'bg-green-400/10';
                if (plan.status === 'Completed') {
                    statusColor = 'text-blue-400';
                    statusBg = 'bg-blue-400/10';
                } else if (plan.daysRemaining < 7) {
                    statusColor = 'text-yellow-400';
                    statusBg = 'bg-yellow-400/10';
                }
                
                planCard.innerHTML = `
                    <div class="flex flex-col md:flex-row md:items-center justify-between">
                        <div class="mb-4 md:mb-0">
                            <div class="flex items-center gap-3 mb-2">
                                <span class="text-2xl">‚õèÔ∏è</span>
                                <h3 class="text-lg font-semibold text-white">${plan.name}</h3>
                                <span class="text-xs px-3 py-1 rounded-full ${statusBg} ${statusColor}">${plan.status}</span>
                            </div>
                            <div class="flex flex-wrap gap-4 text-sm">
                                <div>
                                    <span class="text-gray-400">Investment:</span>
                                    <span class="ml-2 text-white font-medium">$${plan.amount.toFixed(2)}</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">Duration:</span>
                                    <span class="ml-2 text-white font-medium">${plan.duration} days</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">Daily Return:</span>
                                    <span class="ml-2 text-green-400 font-medium">$${plan.dailyEarnings.toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="md:text-right">
                            <div class="mb-2">
                                <span class="text-gray-400">Total Earnings:</span>
                                <div class="text-xl font-bold text-yellow-400">$${plan.totalEarnings.toFixed(2)}</div>
                            </div>
                            <div class="text-sm text-gray-400">
                                ${plan.daysPassed} days elapsed ‚Ä¢ ${plan.daysRemaining} days remaining
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-gray-400">Progress</span>
                            <span class="text-white">${plan.progress.toFixed(1)}%</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2.5">
                            <div class="progress-bar h-2.5 rounded-full" style="width: ${plan.progress}%"></div>
                        </div>
                    </div>
                `;
                
                container.appendChild(planCard);
            });
        }
        
        function displayMiningTransactions(transactions) {
            const container = document.getElementById('miningTransactionsList');
            
            if (transactions.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-12">
                            <p class="text-gray-500">No mining transactions found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort by date (newest first)
            transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            container.innerHTML = '';
            
            transactions.slice(0, 10).forEach(transaction => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-800 hover:bg-gray-800/50';
                
                const date = new Date(transaction.date);
                const formattedDate = date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                
                const amount = parseFloat(transaction.amount) || 0;
                
                // Extract duration from method
                let duration = '30 days';
                if (transaction.method) {
                    const durationMatch = transaction.method.match(/\d+/);
                    if (durationMatch) {
                        duration = `${durationMatch[0]} days`;
                    }
                }
                
                // Calculate daily return (simulated)
                const dailyReturn = amount * 0.02; // 2% daily return
                
                row.innerHTML = `
                    <td class="py-3 px-4 text-sm text-gray-300">${formattedDate}</td>
                    <td class="py-3 px-4 text-sm text-white font-medium">${transaction.method || 'BTC Mining'}</td>
                    <td class="py-3 px-4 text-sm text-green-400 font-semibold">$${amount.toFixed(2)}</td>
                    <td class="py-3 px-4 text-sm text-gray-300">${duration}</td>
                    <td class="py-3 px-4 text-sm">
                        <span class="px-2 py-1 rounded-full text-xs bg-green-400/10 text-green-400">Active</span>
                    </td>
                    <td class="py-3 px-4 text-sm text-yellow-400 font-semibold">$${dailyReturn.toFixed(2)}/day</td>
                `;
                
                container.appendChild(row);
            });
        }
        
        function updateMiningStats(miningPlans, transactions) {
            // Calculate total investment
            let totalInvestment = 0;
            let totalEarnings = 0;
            let totalDays = 0;
            let activePlans = 0;
            
            miningPlans.forEach(plan => {
                totalInvestment += plan.amount;
                totalEarnings += plan.totalEarnings;
                totalDays += plan.daysPassed;
                if (plan.status === 'Active') activePlans++;
            });
            
            // Calculate daily average
            const dailyAverage = totalDays > 0 ? totalEarnings / totalDays : 0;
            
            // Calculate remaining days across all active plans
            let remainingDays = 0;
            miningPlans.forEach(plan => {
                if (plan.status === 'Active') {
                    remainingDays += plan.daysRemaining;
                }
            });
            
            // Update DOM
            document.getElementById('totalInvestment').textContent = `$${totalInvestment.toFixed(2)}`;
            document.getElementById('totalEarnings').textContent = `$${totalEarnings.toFixed(2)}`;
            document.getElementById('totalDays').textContent = totalDays;
            document.getElementById('activePlansCount').textContent = activePlans;
            document.getElementById('dailyAverage').textContent = `$${dailyAverage.toFixed(2)}`;
            document.getElementById('remainingDays').textContent = remainingDays;
        }
        
        function initializeCharts(miningPlans, transactions) {
            // Destroy existing charts if they exist
            if (earningsChart) earningsChart.destroy();
            if (distributionChart) distributionChart.destroy();
            if (candlestickChart) candlestickChart.destroy();
            
            // 1. Earnings Line Chart
            const earningsCtx = document.getElementById('earningsChart').getContext('2d');
            
            // Generate sample earnings data for the last 30 days
            const dates = [];
            const earningsData = [];
            let cumulativeEarnings = 0;
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                
                // Simulate daily earnings with some randomness
                const dailyEarn = miningPlans.reduce((sum, plan) => {
                    return sum + (plan.status === 'Active' ? plan.dailyEarnings : 0);
                }, 0) * (0.8 + Math.random() * 0.4);
                
                cumulativeEarnings += dailyEarn;
                earningsData.push(cumulativeEarnings);
            }
            
            earningsChart = new Chart(earningsCtx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Total Earnings',
                        data: earningsData,
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#9ca3af' }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#9ca3af' }
                        },
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { 
                                color: '#9ca3af',
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            }
                        }
                    }
                }
            });
            
            // 2. Distribution Pie Chart
            const distributionCtx = document.getElementById('distributionChart').getContext('2d');
            
            // Group by mining plan type
            const planTypes = {};
            miningPlans.forEach(plan => {
                const type = plan.name;
                if (!planTypes[type]) {
                    planTypes[type] = 0;
                }
                planTypes[type] += plan.amount;
            });
            
            const planLabels = Object.keys(planTypes);
            const planAmounts = Object.values(planTypes);
            
            // Generate colors for each plan
            const planColors = planLabels.map((_, i) => {
                const hue = (i * 137.508) % 360; // Golden angle approximation
                return `hsl(${hue}, 70%, 60%)`;
            });
            
            distributionChart = new Chart(distributionCtx, {
                type: 'doughnut',
                data: {
                    labels: planLabels,
                    datasets: [{
                        data: planAmounts,
                        backgroundColor: planColors,
                        borderWidth: 0,
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#9ca3af', padding: 20 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const total = planAmounts.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${context.label}: $${value.toFixed(2)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            // 3. Candlestick Chart for Daily Performance
            const candlestickCtx = document.getElementById('candlestickChart').getContext('2d');
            
            // Generate candlestick data for last 7 days
            const candlestickLabels = [];
            const candlestickData = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                candlestickLabels.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
                
                // Simulate OHLC data
                const base = 100 + Math.random() * 50;
                const open = base;
                const close = base * (0.95 + Math.random() * 0.1);
                const high = Math.max(open, close) * (1 + Math.random() * 0.05);
                const low = Math.min(open, close) * (0.95 - Math.random() * 0.05);
                
                candlestickData.push({
                    o: open,
                    h: high,
                    l: low,
                    c: close
                });
            }
            
            candlestickChart = new Chart(candlestickCtx, {
                type: 'candlestick',
                data: {
                    labels: candlestickLabels,
                    datasets: [{
                        label: 'Daily Performance',
                        data: candlestickData,
                        color: {
                            up: '#10b981',
                            down: '#ef4444',
                            unchanged: '#6b7280'
                        }
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#9ca3af' }
                        },
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { 
                                color: '#9ca3af',
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#9ca3af' }
                        }
                    }
                }
            });
        }
        
        function displayNoMiningPlans() {
            const container = document.getElementById('miningPlansContainer');
            container.innerHTML = `
                <div class="mining-card p-6 text-center">
                    <div class="text-5xl mb-4">‚õèÔ∏è</div>
                    <h3 class="text-xl font-semibold text-white mb-3">No Active Mining Plans</h3>
                    <p class="text-gray-400 mb-6">Start mining Bitcoin today with our AI-powered cloud mining platform</p>
                    <a href="btc-miner.html" class="inline-block bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 text-white px-6 py-3 rounded-lg font-semibold transition">
                        Browse Mining Plans
                    </a>
                </div>
            `;
            
            // Reset stats
            document.getElementById('totalInvestment').textContent = '$0.00';
            document.getElementById('totalEarnings').textContent = '$0.00';
            document.getElementById('totalDays').textContent = '0';
            document.getElementById('activePlansCount').textContent = '0';
            document.getElementById('dailyAverage').textContent = '$0.00';
            document.getElementById('remainingDays').textContent = '0';
        }
        
        function refreshMiningData() {
            const userEmail = localStorage.getItem("v0trade_user_email");
            if (!userEmail) return;
            
            // Show loading state
            const container = document.getElementById('miningPlansContainer');
            container.innerHTML = `
                <div class="mining-card p-6 text-center">
                    <div class="flex flex-col items-center justify-center">
                        <svg class="animate-spin h-12 w-12 text-purple-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="text-gray-400">Refreshing mining data...</p>
                    </div>
                </div>
            `;
            
            // Reload data
            setTimeout(() => {
                loadMiningData(userEmail);
                
                // Show success indicator
                const refreshBtn = document.querySelector('button[onclick="refreshMiningData()"]');
                const originalText = refreshBtn.innerHTML;
                refreshBtn.innerHTML = '‚úì Refreshed';
                refreshBtn.classList.add('glowing-border');
                
                setTimeout(() => {
                    refreshBtn.innerHTML = originalText;
                    refreshBtn.classList.remove('glowing-border');
                }, 2000);
            }, 1000);
        }
        
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('active');
        }
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }
        
        // Auto-refresh when returning to the page
        window.addEventListener('focus', () => {
            const userEmail = localStorage.getItem("v0trade_user_email");
            if (userEmail) {
                loadMiningData(userEmail);
            }
        });
        
        // Auto-refresh charts every 30 seconds for real-time feel
        setInterval(() => {
            const userEmail = localStorage.getItem("v0trade_user_email");
            if (userEmail && earningsChart) {
                // Just update the current charts with new data
                if (earningsChart) {
                    const dataset = earningsChart.data.datasets[0];
                    const lastValue = dataset.data[dataset.data.length - 1];
                    const newValue = lastValue * (0.99 + Math.random() * 0.02); // Small random change
                    dataset.data.push(newValue);
                    dataset.data.shift();
                    
                    earningsChart.update('none');
                }
            }
        }, 30000);
    </script>

</body>
</html>
