<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment Tracks - V0 Trade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <!-- Add currency config script -->
    <script src="/js/currency-config.js"></script>
    <style>
        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: rgb(203 213 225);
            border-radius: 0.5rem;
            transition: all 0.2s;
        }
        .sidebar-link:hover {
            background-color: rgb(168 85 247 / 0.1);
            color: rgb(168 85 247);
        }
        .sidebar-link.active {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(236, 72, 153, 0.2));
            color: rgb(168 85 247);
            font-weight: 600;
        }
        
        /* Updated mobile sidebar with toggle button behavior */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                height: 100vh;
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
                z-index: 40;
                width: 240px;
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .sidebar-overlay {
                display: none;
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 30;
            }
            .sidebar-overlay.active {
                display: block;
            }
            .sidebar-toggle {
                display: flex;
            }
        }
        
        @media (min-width: 769px) {
            .sidebar-toggle {
                display: none;
            }
        }
        
        .mobile-menu { display: none; }
        .mobile-menu.active { display: block; }
        .dropdown { position: relative; display: inline-block; }
        .dropdown-content { display: none; position: absolute; background-color: rgb(15 23 42 / 0.95); min-width: 12rem; border: 1px solid rgb(168 85 247 / 0.2); border-radius: 0.5rem; padding: 0.5rem; z-index: 1000; backdrop-filter: blur(10px); }
        .dropdown:hover .dropdown-content { display: block; }
        
        .investment-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(168, 85, 247, 0.1));
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 1rem;
            transition: all 0.3s ease;
        }
        
        .investment-card:hover {
            border-color: rgba(168, 85, 247, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(168, 85, 247, 0.1);
        }
        
        /* Chart containers */
        .chart-container {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            border: 1px solid rgba(168, 85, 247, 0.2);
        }
        
        /* Progress bars */
        .progress-bar {
            height: 8px;
            background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6);
            border-radius: 4px;
            animation: progressAnimation 2s ease-in-out infinite alternate;
        }
        
        @keyframes progressAnimation {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        
        /* Badge styles */
        .badge-crypto { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
        .badge-stock { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; }
        .badge-etf { background: linear-gradient(135deg, #10b981, #047857); color: white; }
        .badge-metal { background: linear-gradient(135deg, #fbbf24, #d97706); color: white; }
        
        .investment-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Chart animations */
        @keyframes chartLineDraw {
            from { stroke-dashoffset: 1000; }
            to { stroke-dashoffset: 0; }
        }
        
        @keyframes pieSliceGrow {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        @keyframes candleFlicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }
        
        .candle-up {
            fill: #10b981;
            animation: candleFlicker 1.5s ease-in-out infinite;
        }
        
        .candle-down {
            fill: #ef4444;
            animation: candleFlicker 1.5s ease-in-out infinite;
        }
        
        /* Stats card animations */
        .stats-card {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(236, 72, 153, 0.05));
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            border-color: rgba(168, 85, 247, 0.4);
        }
        
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Currency switcher styles */
        .currency-switcher {
            position: relative;
            display: inline-block;
        }
        
        .currency-selector {
            padding: 8px 12px;
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 6px;
            background: rgba(30, 41, 59, 0.5);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .currency-selector:hover {
            border-color: #a855f7;
            background: rgba(168, 85, 247, 0.1);
        }
        
        .currency-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            min-width: 200px;
            z-index: 1000;
            display: none;
            margin-top: 5px;
            padding: 8px;
            backdrop-filter: blur(10px);
        }
        
        .currency-dropdown.show {
            display: block;
            animation: fadeIn 0.2s ease;
        }
        
        .currency-option-dropdown {
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 6px;
            color: #e2e8f0;
            font-size: 14px;
        }
        
        .currency-option-dropdown:hover {
            background: rgba(168, 85, 247, 0.1);
        }
        
        .currency-option-dropdown.active {
            background: rgba(168, 85, 247, 0.15);
            color: white;
            font-weight: 600;
        }
        
        .currency-option-dropdown .symbol {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }
        
        .currency-option-dropdown .code {
            font-weight: 600;
            min-width: 40px;
        }
        
        .currency-option-dropdown .name {
            color: #94a3b8;
            font-size: 12px;
            flex-grow: 1;
            text-align: right;
        }
        
        /* Mobile currency selector - always visible */
        .mobile-currency-toggle {
            padding: 8px 12px;
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 6px;
            background: rgba(30, 41, 59, 0.5);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 14px;
            transition: all 0.3s;
            margin-left: auto;
            margin-right: 12px;
        }
        
        .mobile-currency-dropdown {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            width: 90%;
            max-width: 320px;
            z-index: 1100;
            display: none;
            padding: 16px;
            backdrop-filter: blur(20px);
        }
        
        .mobile-currency-dropdown.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .mobile-currency-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1099;
            display: none;
        }
        
        .mobile-currency-overlay.show {
            display: block;
        }
        
        .mobile-currency-option {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 16px;
            margin-bottom: 8px;
        }
        
        .mobile-currency-option:hover {
            background: rgba(168, 85, 247, 0.1);
        }
        
        .mobile-currency-option.active {
            background: rgba(168, 85, 247, 0.2);
            color: white;
            font-weight: 600;
        }
        
        .mobile-currency-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(168, 85, 247, 0.2);
        }
        
        .mobile-currency-header h3 {
            color: white;
            font-size: 18px;
            font-weight: 600;
        }
        
        .close-currency-menu {
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 24px;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
        }
        
        .close-currency-menu:hover {
            background: rgba(168, 85, 247, 0.1);
            color: white;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -48%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }
        
        /* Status colors */
        .status-active { background: rgba(34, 197, 94, 0.1); color: #22c55e; }
        .status-completed { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
        .status-pending { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
        .status-expired { background: rgba(239, 68, 68, 0.1); color: #ef4444; }
        
        .time-remaining { 
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-slate-950">
    
    <!-- Added hamburger toggle button for mobile sidebar -->
    <button onclick="toggleSidebar()" class="sidebar-toggle fixed left-4 top-20 z-50 bg-purple-500 hover:bg-purple-600 text-white p-2 rounded-lg shadow-lg transition">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
    </button>
    
    <!-- Added overlay for mobile sidebar -->
    <div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>
    
    <!-- Updated header with currency switcher -->
    <header class="sticky top-0 z-50 border-b border-purple-500/20 bg-slate-950/80 backdrop-blur-md">
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between py-4">
                <a href="index.html" class="flex items-center gap-2 hover:opacity-80 transition">
                    <div class="h-10 w-10">
                        <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" class="w-full h-full">
                            <defs>
                                <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color: #a78bfa; stop-opacity: 1" />
                                    <stop offset="50%" style="stop-color: #ec4899; stop-opacity: 1" />
                                    <stop offset="100%" style="stop-color: #06b6d4; stop-opacity: 1" />
                                </linearGradient>
                            </defs>
                            <circle cx="100" cy="100" r="95" fill="url(#logoGradient)" opacity="0.2" />
                            <circle cx="100" cy="100" r="90" fill="none" stroke="url(#logoGradient)" stroke-width="2" />
                            <path d="M 50 60 L 80 140 M 150 60 L 120 140" stroke="url(#logoGradient)" stroke-width="8" stroke-linecap="round" fill="none" />
                            <circle cx="100" cy="100" r="25" fill="none" stroke="url(#logoGradient)" stroke-width="6" />
                        </svg>
                    </div>
                    <span class="text-xl font-bold bg-gradient-to-r from-purple-400 via-pink-400 to-cyan-400 bg-clip-text text-transparent">V0 Trade</span>
                </a>

                <!-- Desktop Navigation -->
                <nav class="hidden items-center gap-8 md:flex">
                    <a href="index.html" class="text-sm text-gray-300 hover:text-white transition">Home</a>
                    <div class="dropdown">
                        <button class="text-sm text-gray-300 hover:text-white transition flex items-center gap-1">Invest <span>‚ñº</span></button>
                        <div class="dropdown-content">
                            <a href="cryptocurrencies.html" class="block px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-purple-500/10 rounded">Cryptocurrencies</a>
                            <a href="precious-metals.html" class="block px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-purple-500/10 rounded">Precious Metals</a>
                            <a href="stocks.html" class="block px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-purple-500/10 rounded">Stocks</a>
                            <a href="etfs.html" class="block px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-purple-500/10 rounded">ETFs</a>
                        </div>
                    </div>
                    <a href="btc-miner.html" class="text-sm text-gray-300 hover:text-white transition">BTC Miner</a>
                    <a href="about.html" class="text-sm text-gray-300 hover:text-white transition">About</a>
                    <a href="security.html" class="text-sm text-gray-300 hover:text-white transition">Security</a>
                    <div class="dropdown">
                        <button class="text-sm text-gray-300 hover:text-white transition flex items-center gap-1">Support <span>‚ñº</span></button>
                        <div class="dropdown-content">
                            <a href="contact.html" class="block px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-purple-500/10 rounded">Contact Support</a>
                            <a href="faq.html" class="block px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-purple-500/10 rounded">FAQ</a>
                        </div>
                    </div>
                </nav>

                <!-- Right Side - Auth with Currency Switcher -->
                <div class="hidden items-center gap-4 md:flex">
                    <!-- Desktop Currency Switcher -->
                    <div class="currency-switcher">
                        <div class="currency-selector" onclick="toggleCurrencyDropdown(event)">
                            <span class="current-symbol">$</span>
                            <span class="current-code">USD</span>
                            <span>‚ñº</span>
                        </div>
                        <div class="currency-dropdown" id="currencyDropdown"></div>
                    </div>
                    
                    <a href="dashboard.html" class="text-sm text-purple-400 hover:text-purple-300 transition">Dashboard</a>
                    <span class="text-sm text-gray-400" id="userEmail">user@email.com</span>
                    <a href="javascript:void(0)" onclick="logout()" class="text-sm text-gray-300 hover:text-white transition">Logout</a>
                </div>

                <!-- Mobile header section with currency toggle and menu button -->
                <div class="flex items-center gap-2 md:hidden">
                    <!-- Mobile Currency Toggle (always visible) -->
                    <button class="mobile-currency-toggle" onclick="toggleMobileCurrencyMenu()">
                        <span class="mobile-currency-symbol">$</span>
                        <span class="mobile-currency-code">USD</span>
                        <span>‚ñº</span>
                    </button>

                    <!-- Mobile Menu Button -->
                    <button class="md:hidden" onclick="toggleMobileMenu()">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Menu (without currency selector) -->
            <div id="mobileMenu" class="mobile-menu border-t border-purple-500/20 py-4 md:hidden">
                <nav class="flex flex-col gap-3">
                    <a href="index.html" class="text-sm text-gray-300 hover:text-white">Home</a>
                    <a href="cryptocurrencies.html" class="text-sm text-gray-300 hover:text-white">Cryptocurrencies</a>
                    <a href="precious-metals.html" class="text-sm text-gray-300 hover:text-white">Precious Metals</a>
                    <a href="stocks.html" class="text-sm text-gray-300 hover:text-white">Stocks</a>
                    <a href="etfs.html" class="text-sm text-gray-300 hover:text-white">ETFs</a>
                    <a href="btc-miner.html" class="text-sm text-gray-300 hover:text-white">BTC Miner</a>
                    <a href="about.html" class="text-sm text-gray-300 hover:text-white">About</a>
                    <a href="security.html" class="text-sm text-gray-300 hover:text-white">Security</a>
                    <a href="contact.html" class="text-sm text-gray-300 hover:text-white">Contact</a>
                    <a href="faq.html" class="text-sm text-gray-300 hover:text-white">FAQ</a>
                    <a href="dashboard.html" class="text-sm text-purple-400 hover:text-purple-300">Dashboard</a>
                    <a href="javascript:void(0)" onclick="logout()" class="text-sm text-gray-300 hover:text-white">Logout</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Mobile Currency Menu Overlay -->
    <div class="mobile-currency-overlay" id="mobileCurrencyOverlay" onclick="closeMobileCurrencyMenu()"></div>
    
    <!-- Mobile Currency Menu -->
    <div class="mobile-currency-dropdown" id="mobileCurrencyMenu">
        <div class="mobile-currency-header">
            <h3>Select Currency</h3>
            <button class="close-currency-menu" onclick="closeMobileCurrencyMenu()">√ó</button>
        </div>
        <div class="mobile-currency-options">
            <!-- Options will be populated by JavaScript -->
        </div>
    </div>

    <div class="flex min-h-screen">
        <!-- Added id for sidebar toggle functionality -->
        <aside id="sidebar" class="sidebar w-64 bg-slate-900/50 border-r border-purple-500/20 p-4 backdrop-blur-sm">
            <div class="space-y-1 mb-6">
                <a href="deposit.html" class="sidebar-link">
                    <span>üí∞</span>
                    <span class="sidebar-text">Deposit</span>
                </a>
                <a href="withdraw.html" class="sidebar-link">
                    <span>üí∏</span>
                    <span class="sidebar-text">Withdraw</span>
                </a>
            </div>
            
            <div class="mb-6">
                <a href="dashboard.html" class="sidebar-link">
                    <span>üìä</span>
                    <span class="sidebar-text">Dashboard</span>
                </a>
                <a href="coin-wallets.html" class="sidebar-link">
                    <span>ü™ô</span>
                    <span class="sidebar-text">Coin Wallets</span>
                </a>
                <a href="mining-tracks.html" class="sidebar-link">
                    <span>‚õèÔ∏è</span>
                    <span class="sidebar-text">Mining Tracks</span>
                </a>
                <a href="investment-tracks.html" class="sidebar-link active">
                    <span>üìà</span>
                    <span class="sidebar-text">Investment Tracks</span>
                </a>
            </div>

            <div class="mb-2">
                <p class="text-xs font-semibold text-gray-500 uppercase px-4 mb-2 sidebar-text">Report</p>
                <a href="referral-commissions.html" class="sidebar-link">
                    <span>üéÅ</span>
                    <span class="sidebar-text">Ref. Commissions</span>
                </a>
                <a href="deposit-history.html" class="sidebar-link">
                    <span>üì•</span>
                    <span class="sidebar-text">Deposit History</span>
                </a>
                <a href="order-history.html" class="sidebar-link">
                    <span>üìã</span>
                    <span class="sidebar-text">Order History</span>
                </a>
                <a href="withdrawals-log.html" class="sidebar-link">
                    <span>üì§</span>
                    <span class="sidebar-text">Withdrawals Log</span>
                </a>
                <a href="transactions.html" class="sidebar-link">
                    <span>üí≥</span>
                    <span class="sidebar-text">Transactions</span>
                </a>
            </div>

            <div>
                <p class="text-xs font-semibold text-gray-500 uppercase px-4 mb-2 sidebar-text">Support</p>
                <a href="open-ticket.html" class="sidebar-link">
                    <span>üé´</span>
                    <span class="sidebar-text">Open New Ticket</span>
                </a>
                <a href="support-tickets.html" class="sidebar-link">
                    <span>üì®</span>
                    <span class="sidebar-text">Support Tickets</span>
                </a>
            </div>
        </aside>

        <!-- New investment tracks page for crypto, ETF, stock, and metal investments -->
        <main class="flex-1 p-4 md:p-8 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950">
            <div class="max-w-7xl mx-auto">
                <!-- Header -->
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-white mb-2">Investment Tracks</h1>
                        <p class="text-gray-400">Monitor all your active investments across Crypto, Stocks, ETFs, and Precious Metals</p>
                    </div>
                    <button onclick="refreshInvestments()" class="mt-4 md:mt-0 flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-lg font-medium transition">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        Refresh Data
                    </button>
                </div>

                <!-- Investment Stats Summary -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-400 mb-1">Total Investment</p>
                                <p id="totalInvestment" class="text-2xl font-bold text-white"><span class="currency-symbol">$</span>0.00</p>
                            </div>
                            <div class="text-3xl pulse">üí∞</div>
                        </div>
                        <div class="mt-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-400">Active Plans</span>
                                <span id="activePlansCount" class="text-green-400">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-400 mb-1">Total Returns</p>
                                <p id="totalReturns" class="text-2xl font-bold text-white"><span class="currency-symbol">$</span>0.00</p>
                            </div>
                            <div class="text-3xl text-yellow-400">üìà</div>
                        </div>
                        <div class="mt-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-400">Daily Average</span>
                                <span id="dailyAverage" class="text-green-400"><span class="currency-symbol">$</span>0.00</span>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-400 mb-1">Portfolio Value</p>
                                <p id="portfolioValue" class="text-2xl font-bold text-white"><span class="currency-symbol">$</span>0.00</p>
                            </div>
                            <div class="text-3xl text-cyan-400">üíé</div>
                        </div>
                        <div class="mt-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-400">Growth</span>
                                <span id="growthPercentage" class="text-green-400">0%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-400 mb-1">Best Performer</p>
                                <p id="bestPerformer" class="text-2xl font-bold text-white">-</p>
                            </div>
                            <div class="text-3xl text-purple-400">üèÜ</div>
                        </div>
                        <div class="mt-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-400">Returns</span>
                                <span id="bestPerformerReturns" class="text-green-400"><span class="currency-symbol">$</span>0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filter Tabs -->
                <div class="flex gap-2 mb-6 overflow-x-auto">
                    <button onclick="filterInvestments('all')" class="filter-btn px-4 py-2 rounded-lg bg-purple-500/20 text-purple-400 border border-purple-500/30 whitespace-nowrap">All Investments</button>
                    <button onclick="filterInvestments('crypto')" class="filter-btn px-4 py-2 rounded-lg bg-slate-800 text-gray-400 border border-slate-700 hover:bg-slate-700 whitespace-nowrap">Cryptocurrencies</button>
                    <button onclick="filterInvestments('stock')" class="filter-btn px-4 py-2 rounded-lg bg-slate-800 text-gray-400 border border-slate-700 hover:bg-slate-700 whitespace-nowrap">Stocks</button>
                    <button onclick="filterInvestments('etf')" class="filter-btn px-4 py-2 rounded-lg bg-slate-800 text-gray-400 border border-slate-700 hover:bg-slate-700 whitespace-nowrap">ETFs</button>
                    <button onclick="filterInvestments('metal')" class="filter-btn px-4 py-2 rounded-lg bg-slate-800 text-gray-400 border border-slate-700 hover:bg-slate-700 whitespace-nowrap">Precious Metals</button>
                </div>

                <!-- Charts Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Performance Line Chart -->
                    <div class="chart-container p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Investment Performance</h3>
                        <div class="h-64">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>

                    <!-- Investment Distribution Pie Chart -->
                    <div class="chart-container p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Investment Distribution</h3>
                        <div class="h-64">
                            <canvas id="distributionChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Candlestick Chart -->
                <div class="chart-container p-6 mb-8">
                    <h3 class="text-lg font-semibold text-white mb-4">Market Performance</h3>
                    <div class="h-80">
                        <canvas id="candlestickChart"></canvas>
                    </div>
                </div>

                <!-- Active Investments -->
                <div class="mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-white">Active Investments</h2>
                        <div class="flex gap-2">
                            <a href="cryptocurrencies.html" class="text-sm bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 text-white px-4 py-2 rounded-lg font-medium transition">
                                + Crypto
                            </a>
                            <a href="stocks.html" class="text-sm bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white px-4 py-2 rounded-lg font-medium transition">
                                + Stocks
                            </a>
                            <a href="etfs.html" class="text-sm bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white px-4 py-2 rounded-lg font-medium transition">
                                + ETFs
                            </a>
                            <a href="precious-metals.html" class="text-sm bg-gradient-to-r from-yellow-500 to-amber-500 hover:from-yellow-600 hover:to-amber-600 text-white px-4 py-2 rounded-lg font-medium transition">
                                + Metals
                            </a>
                        </div>
                    </div>

                    <div id="investmentContainer" class="space-y-4">
                        <!-- Investments will be loaded here -->
                        <div class="investment-card p-6 text-center">
                            <div class="text-5xl mb-4">üìà</div>
                            <h3 class="text-xl font-semibold text-white mb-3">No Active Investments</h3>
                            <p class="text-gray-400 mb-6">Start investing to track your portfolio performance here</p>
                            <div class="flex gap-4 justify-center flex-wrap">
                                <a href="cryptocurrencies.html" class="text-sm text-orange-400 hover:text-orange-300">Invest in Crypto</a>
                                <a href="stocks.html" class="text-sm text-blue-400 hover:text-blue-300">Invest in Stocks</a>
                                <a href="etfs.html" class="text-sm text-green-400 hover:text-green-300">Invest in ETFs</a>
                                <a href="precious-metals.html" class="text-sm text-yellow-400 hover:text-yellow-300">Invest in Metals</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Investment Transactions History -->
                <div class="chart-container p-6">
                    <h3 class="text-lg font-semibold text-white mb-4">Investment Transactions</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-700">
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-400">Date</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-400">Type</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-400">Asset</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-400">Plan</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-400">Investment</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-400">Duration</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-400">Status</th>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-400">Returns</th>
                                </tr>
                            </thead>
                            <tbody id="investmentTransactionsList">
                                <tr>
                                    <td colspan="8" class="text-center py-12">
                                        <p class="text-gray-500">Loading investment transactions...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
    // Currency data
    const CURRENCIES = [
        { code: 'USD', symbol: '$', name: 'US Dollar' },
        { code: 'EUR', symbol: '‚Ç¨', name: 'Euro' },
        { code: 'GBP', symbol: '¬£', name: 'British Pound' },
        { code: 'ZAR', symbol: 'R', name: 'South African Rand' },
        { code: 'INR', symbol: '‚Çπ', name: 'Indian Rupee' },
        { code: 'JPY', symbol: '¬•', name: 'Japanese Yen' },
        { code: 'AUD', symbol: 'A$', name: 'Australian Dollar' },
        { code: 'CAD', symbol: 'C$', name: 'Canadian Dollar' }
    ];
    
    // Storage keys
    const TRANSACTIONS_DATA_KEY = "v0trade_transactions_data";
    const INVESTMENT_CACHE_KEY = "v0trade_investment_cache";
    const INVESTMENT_DATA_KEY = "v0trade_investment_data"; // Persistent storage for processed investments
    const INVESTMENT_CACHE_EXPIRY = 5 * 60 * 1000; // 5 minutes cache
    
    // Investment plan configurations with updated ROI from your info
    const INVESTMENT_PLANS = {
        // Cryptocurrencies
        'btc': { type: 'crypto', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Bitcoin (BTC)', badge: 'badge-crypto', color: '#f59e0b' },
        'bitcoin': { type: 'crypto', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Bitcoin (BTC)', badge: 'badge-crypto', color: '#f59e0b' },
        'eth': { type: 'crypto', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Ethereum (ETH)', badge: 'badge-crypto', color: '#8b5cf6' },
        'ethereum': { type: 'crypto', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Ethereum (ETH)', badge: 'badge-crypto', color: '#8b5cf6' },
        'usdt': { type: 'crypto', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Tether (USDT)', badge: 'badge-crypto', color: '#26a17b' },
        'tether': { type: 'crypto', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Tether (USDT)', badge: 'badge-crypto', color: '#26a17b' },
        
        // Precious Metals
        'gold': { type: 'metal', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Gold', badge: 'badge-metal', color: '#fbbf24' },
        'silver': { type: 'metal', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Silver', badge: 'badge-metal', color: '#9ca3af' },
        'platinum': { type: 'metal', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Platinum', badge: 'badge-metal', color: '#e5e7eb' },
        'rhodium': { type: 'metal', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Rhodium', badge: 'badge-metal', color: '#a78bfa' },
        'palladium': { type: 'metal', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Palladium', badge: 'badge-metal', color: '#f472b6' },
        
        // Stocks
        'nvidia': { type: 'stock', roi: 20, duration: 1, durationUnit: 'hour', asset: 'NVIDIA (NVDA)', badge: 'badge-stock', color: '#3b82f6' },
        'apple': { type: 'stock', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Apple (AAPL)', badge: 'badge-stock', color: '#1d4ed8' },
        'microsoft': { type: 'stock', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Microsoft (MSFT)', badge: 'badge-stock', color: '#1e40af' },
        'google': { type: 'stock', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Google (GOOGL)', badge: 'badge-stock', color: '#0ea5e9' },
        'amazon': { type: 'stock', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Amazon (AMZN)', badge: 'badge-stock', color: '#f97316' },
        
        // ETFs
        'spy': { type: 'etf', roi: 20, duration: 1, durationUnit: 'hour', asset: 'SPDR S&P 500 (SPY)', badge: 'badge-etf', color: '#10b981' },
        'voo': { type: 'etf', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Vanguard S&P 500 (VOO)', badge: 'badge-etf', color: '#047857' },
        'ivv': { type: 'etf', roi: 20, duration: 1, durationUnit: 'hour', asset: 'iShares S&P 500 (IVV)', badge: 'badge-etf', color: '#065f46' },
        'vti': { type: 'etf', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Vanguard Total Market (VTI)', badge: 'badge-etf', color: '#064e3b' },
        'qqq': { type: 'etf', roi: 20, duration: 1, durationUnit: 'hour', asset: 'Invesco QQQ (QQQ)', badge: 'badge-etf', color: '#059669' }
    };
    
    // Plan duration patterns to parse from method field
    const PLAN_DURATIONS = {
        '1 hour': { duration: 1, durationUnit: 'hour', roi: 20 },
        '1 Hour': { duration: 1, durationUnit: 'hour', roi: 20 },
        '5 hours': { duration: 5, durationUnit: 'hour', roi: 30 },
        '5 Hours': { duration: 5, durationUnit: 'hour', roi: 30 },
        '24 hours': { duration: 24, durationUnit: 'hour', roi: 68 },
        '24 Hours': { duration: 24, durationUnit: 'hour', roi: 68 },
        '72 hours': { duration: 72, durationUnit: 'hour', roi: 89 },
        '72 Hours': { duration: 72, durationUnit: 'hour', roi: 89 },
        '1 week': { duration: 7, durationUnit: 'day', roi: 190 },
        '1 Week': { duration: 7, durationUnit: 'day', roi: 190 },
        '1 day': { duration: 1, durationUnit: 'day', roi: 68 },
        '6 days': { duration: 6, durationUnit: 'day', roi: 150 }
    };
    
    // Chart instances
    let performanceChart = null;
    let distributionChart = null;
    let candlestickChart = null;
    
    // Currency functions
    function getCurrentCurrency() {
        return localStorage.getItem('v0trade_currency') || 'USD';
    }
    
    function getCurrentCurrencySymbol() {
        const currentCurrency = getCurrentCurrency();
        const currency = CURRENCIES.find(c => c.code === currentCurrency);
        return currency ? currency.symbol : '$';
    }
    
    function updateCurrencySymbols(currencyCode) {
        const currency = CURRENCIES.find(c => c.code === currencyCode);
        if (!currency) return;
        
        document.querySelectorAll('.currency-symbol').forEach(el => {
            el.textContent = currency.symbol;
        });
        
        document.querySelector('.mobile-currency-symbol').textContent = currency.symbol;
        document.querySelector('.mobile-currency-code').textContent = currency.code;
        
        const desktopSelector = document.querySelector('.currency-selector');
        if (desktopSelector) {
            desktopSelector.querySelector('.current-symbol').textContent = currency.symbol;
            desktopSelector.querySelector('.current-code').textContent = currency.code;
        }
        
        const userEmail = localStorage.getItem("v0trade_user_email");
        if (userEmail) {
            updateCurrencyDisplay();
        }
    }
    
    function convertAmount(amount, fromCurrency, toCurrency) {
        const rates = {
            'USD': 1,
            'EUR': 0.92,
            'GBP': 0.79,
            'ZAR': 18.75,
            'INR': 83.5,
            'JPY': 150,
            'AUD': 1.52,
            'CAD': 1.36
        };
        
        if (!rates[fromCurrency] || !rates[toCurrency]) return amount;
        
        const amountInUSD = amount / rates[fromCurrency];
        return amountInUSD * rates[toCurrency];
    }
    
    function updateCurrencyDisplay() {
        const currentCurrency = getCurrentCurrency();
        const currency = CURRENCIES.find(c => c.code === currentCurrency);
        if (!currency) return;
        
        // Update all elements with data-amount attributes
        document.querySelectorAll('[data-amount]').forEach(el => {
            if (!el.classList.contains('currency-symbol')) {
                const amount = parseFloat(el.getAttribute('data-amount') || '0');
                const convertedAmount = convertAmount(amount, 'USD', currentCurrency);
                
                if (el.tagName === 'INPUT') {
                    el.value = convertedAmount.toFixed(2);
                } else {
                    // Check if it's a currency display (starts with $, ‚Ç¨, etc.)
                    const currentText = el.textContent;
                    if (currentText.match(/^[\$\‚Ç¨\¬£\‚Çπ\¬•\R]/)) {
                        el.textContent = `${currency.symbol}${convertedAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                    } else {
                        el.textContent = convertedAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                    }
                }
            }
        });
        
        // Update currency symbols
        document.querySelectorAll('.currency-symbol').forEach(el => {
            el.textContent = currency.symbol;
        });
    }
    
    // Mobile menu functions
    function toggleMobileMenu() {
        const menu = document.getElementById('mobileMenu');
        if (menu) {
            menu.classList.toggle('active');
        }
    }
    
    function closeMobileMenu() {
        const menu = document.getElementById('mobileMenu');
        if (menu) {
            menu.classList.remove('active');
        }
    }
    
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        if (sidebar && overlay) {
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }
    }
    
    function logout() {
        if (confirm('Are you sure you want to log out?')) {
            localStorage.removeItem("v0trade_user_email");
            window.location.href = 'index.html';
        }
    }
    
    // Parse duration from method field
    function parseDurationFromMethod(method) {
        if (!method) return { duration: 1, durationUnit: 'hour', roi: 20 };
        
        const methodLower = method.toLowerCase();
        
        // Check for plan durations
        for (const [pattern, plan] of Object.entries(PLAN_DURATIONS)) {
            if (methodLower.includes(pattern.toLowerCase())) {
                return plan;
            }
        }
        
        // Try to parse numbers with time units
        const hourMatch = methodLower.match(/(\d+)\s*hour/);
        if (hourMatch) {
            const hours = parseInt(hourMatch[1]);
            let roi = 20;
            if (hours === 5) roi = 30;
            else if (hours === 24) roi = 68;
            else if (hours === 72) roi = 89;
            return { duration: hours, durationUnit: 'hour', roi: roi };
        }
        
        const dayMatch = methodLower.match(/(\d+)\s*day/);
        if (dayMatch) {
            const days = parseInt(dayMatch[1]);
            let roi = 68;
            if (days === 7) roi = 190;
            else if (days === 6) roi = 150;
            return { duration: days, durationUnit: 'day', roi: roi };
        }
        
        const weekMatch = methodLower.match(/(\d+)\s*week/);
        if (weekMatch) {
            const weeks = parseInt(weekMatch[1]);
            const days = weeks * 7;
            return { duration: days, durationUnit: 'day', roi: 190 };
        }
        
        // Default
        return { duration: 1, durationUnit: 'hour', roi: 20 };
    }
    
    // Parse asset from method
    function parseAssetFromMethod(method) {
        if (!method) return null;
        
        const methodLower = method.toLowerCase();
        
        // Check for cryptocurrencies
        if (methodLower.includes('btc') || methodLower.includes('bitcoin')) return 'btc';
        if (methodLower.includes('eth') || methodLower.includes('ethereum')) return 'eth';
        if (methodLower.includes('usdt') || methodLower.includes('tether')) return 'usdt';
        
        // Check for precious metals
        if (methodLower.includes('gold')) return 'gold';
        if (methodLower.includes('silver')) return 'silver';
        if (methodLower.includes('platinum')) return 'platinum';
        if (methodLower.includes('rhodium')) return 'rhodium';
        if (methodLower.includes('palladium')) return 'palladium';
        
        // Check for stocks
        if (methodLower.includes('nvidia') || methodLower.includes('nvda')) return 'nvidia';
        if (methodLower.includes('apple') || methodLower.includes('aapl')) return 'apple';
        if (methodLower.includes('microsoft') || methodLower.includes('msft')) return 'microsoft';
        if (methodLower.includes('google') || methodLower.includes('googl')) return 'google';
        if (methodLower.includes('amazon') || methodLower.includes('amzn')) return 'amazon';
        
        // Check for ETFs
        if (methodLower.includes('spy')) return 'spy';
        if (methodLower.includes('voo')) return 'voo';
        if (methodLower.includes('ivv')) return 'ivv';
        if (methodLower.includes('vti')) return 'vti';
        if (methodLower.includes('qqq')) return 'qqq';
        
        return null;
    }
    
    // Convert duration to milliseconds
    function durationToMs(duration, unit) {
        switch(unit) {
            case 'hour': return duration * 60 * 60 * 1000;
            case 'day': return duration * 24 * 60 * 60 * 1000;
            default: return duration * 60 * 60 * 1000; // Default to hours
        }
    }
    
    // Format time remaining
    function formatTimeRemaining(ms) {
        if (ms <= 0) return "Completed";
        
        const days = Math.floor(ms / (1000 * 60 * 60 * 24));
        const hours = Math.floor((ms % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));
        
        if (days > 0) return `${days}d ${hours}h`;
        if (hours > 0) return `${hours}h ${minutes}m`;
        return `${minutes}m`;
    }
    
    // Format duration for display
    function formatDuration(duration, unit) {
        switch(unit) {
            case 'hour': 
                if (duration === 1) return "1 Hour";
                if (duration === 24) return "1 Day";
                return `${duration} Hours`;
            case 'day':
                if (duration === 1) return "1 Day";
                if (duration === 7) return "1 Week";
                return `${duration} Days`;
            default:
                return `${duration} ${unit}s`;
        }
    }
    
    window.addEventListener('DOMContentLoaded', function() {
        const userEmail = localStorage.getItem("v0trade_user_email");
        
        if (!userEmail) {
            alert("Please login to access this page.");
            window.location.href = "login.html";
            return;
        }

        // Update header with user email
        const emailDisplay = document.getElementById('userEmail');
        if (emailDisplay) {
            emailDisplay.textContent = userEmail;
        }
        
        // Initialize currency system
        const currentCurrency = getCurrentCurrency();
        updateCurrencySymbols(currentCurrency);
        
        // Initialize empty charts
        initializeEmptyCharts();
        
        // Load investment data
        loadInvestmentData(userEmail);
        
        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuButton = document.querySelector('button[onclick="toggleMobileMenu()"]');
            
            if (mobileMenu && mobileMenu.classList.contains('active') && 
                !mobileMenu.contains(event.target) && 
                mobileMenuButton && !mobileMenuButton.contains(event.target)) {
                closeMobileMenu();
            }
        });
    });

    function getStoredInvestmentData(email) {
        try {
            const key = `${INVESTMENT_DATA_KEY}_${email}`;
            const stored = localStorage.getItem(key);
            if (!stored) return null;
            
            const data = JSON.parse(stored);
            
            // Check if any investments need status updates
            const now = Date.now();
            let updated = false;
            
            data.investments = data.investments.map(investment => {
                const endTime = new Date(investment.endTime).getTime();
                
                if (now >= endTime && investment.status !== 'Completed') {
                    investment.status = 'Completed';
                    investment.progress = 100;
                    updated = true;
                } else if (now < endTime && investment.status !== 'Active') {
                    investment.status = 'Active';
                    const startTime = new Date(investment.startTime).getTime();
                    const totalDuration = endTime - startTime;
                    const elapsed = now - startTime;
                    investment.progress = Math.min((elapsed / totalDuration) * 100, 100);
                    updated = true;
                }
                
                return investment;
            });
            
            if (updated) {
                saveInvestmentData(email, data.investments, data.transactions);
            }
            
            return data;
        } catch (e) {
            console.error("Error reading stored investment data:", e);
            return null;
        }
    }
    
    function saveInvestmentData(email, investments, transactions) {
        try {
            const key = `${INVESTMENT_DATA_KEY}_${email}`;
            const data = {
                investments: investments,
                transactions: transactions,
                lastUpdated: Date.now()
            };
            localStorage.setItem(key, JSON.stringify(data));
        } catch (e) {
            console.error("Error saving investment data:", e);
        }
    }
    
    function getCachedInvestmentData(email) {
        try {
            const cacheKey = `${INVESTMENT_CACHE_KEY}_${email}`;
            const cached = localStorage.getItem(cacheKey);
            if (!cached) return null;
            
            const data = JSON.parse(cached);
            const now = Date.now();
            
            if (now - data.timestamp > INVESTMENT_CACHE_EXPIRY) {
                localStorage.removeItem(cacheKey);
                return null;
            }
            
            return data;
        } catch (e) {
            return null;
        }
    }
    
    function cacheInvestmentData(email, data) {
        try {
            const cacheKey = `${INVESTMENT_CACHE_KEY}_${email}`;
            const cacheData = {
                timestamp: Date.now(),
                ...data
            };
            localStorage.setItem(cacheKey, JSON.stringify(cacheData));
        } catch (e) {
            console.error("Failed to cache investment data:", e);
        }
    }

    function loadInvestmentData(email) {
        try {
            console.log("Loading investment data for:", email);
            
            // First, try to load from persistent storage
            const storedData = getStoredInvestmentData(email);
            if (storedData && storedData.investments.length > 0) {
                displayInvestments(storedData.investments);
                displayInvestmentTransactions(storedData.transactions);
                updateInvestmentStats(storedData.investments);
                updateChartsWithData(storedData.investments);
                return;
            }
            
            // Try cached data
            const cachedData = getCachedInvestmentData(email);
            if (cachedData) {
                displayInvestments(cachedData.investments);
                displayInvestmentTransactions(cachedData.transactions);
                updateInvestmentStats(cachedData.investments);
                updateChartsWithData(cachedData.investments);
                
                setTimeout(() => loadFreshInvestmentData(email), 100);
                return;
            }
            
            // Load fresh data
            loadFreshInvestmentData(email);
            
        } catch (err) {
            console.error("Error loading investment data:", err);
            displayNoInvestments();
        }
    }
    
    function loadFreshInvestmentData(email) {
        try {
            console.log("Loading fresh investment data for:", email);
            
            const cachedData = localStorage.getItem(`${TRANSACTIONS_DATA_KEY}_${email}`);
            
            if (!cachedData) {
                console.log("No cached transactions found.");
                displayNoInvestments();
                return;
            }
            
            const allTransactions = JSON.parse(cachedData);
            console.log("Total transactions found in cache:", allTransactions.length);
            
            if (allTransactions.length === 0) {
                displayNoInvestments();
                return;
            }
            
            // Get existing investments to avoid duplicates
            const existingData = getStoredInvestmentData(email);
            const existingIds = existingData ? existingData.investments.map(i => i.id) : [];
            
            // Process transactions to create investments
            const processedInvestments = [];
            const investmentTransactions = [];
            
            allTransactions.forEach(transaction => {
                const type = (transaction.type || '').toLowerCase();
                const method = (transaction.method || '').toLowerCase();
                const combinedText = type + ' ' + method;
                
                // Check if it's an investment transaction
                const isDepositWithdrawal = type.includes('deposit') || 
                                          type.includes('withdraw') ||
                                          method.includes('deposit') ||
                                          method.includes('withdraw');
                
                const isMining = combinedText.includes('miner') || 
                                combinedText.includes('mining') ||
                                combinedText.includes('micro') ||
                                combinedText.includes('plan') && !method.includes('hour') && !method.includes('day');
                
                if (!isDepositWithdrawal && !isMining) {
                    const amount = parseFloat(transaction.amount) || 0;
                    if (amount <= 0) return;
                    
                    // Parse transaction date
                    let transactionDate;
                    try {
                        if (transaction.date) {
                            transactionDate = new Date(transaction.date);
                        } else if (transaction.timestamp) {
                            transactionDate = new Date(transaction.timestamp);
                        }
                        
                        if (!transactionDate || isNaN(transactionDate.getTime())) {
                            transactionDate = new Date();
                        }
                    } catch (e) {
                        transactionDate = new Date();
                    }
                    
                    // Parse duration from method
                    const durationInfo = parseDurationFromMethod(method);
                    
                    // Parse asset from method
                    const assetKey = parseAssetFromMethod(method);
                    let planInfo = INVESTMENT_PLANS[assetKey] || {
                        type: 'crypto',
                        roi: durationInfo.roi,
                        duration: durationInfo.duration,
                        durationUnit: durationInfo.durationUnit,
                        asset: 'Investment',
                        badge: 'badge-crypto',
                        color: '#f59e0b'
                    };
                    
                    // Override ROI with duration-specific ROI
                    planInfo.roi = durationInfo.roi;
                    planInfo.duration = durationInfo.duration;
                    planInfo.durationUnit = durationInfo.durationUnit;
                    
                    // Calculate end time
                    const startTime = transactionDate.getTime();
                    const durationMs = durationToMs(durationInfo.duration, durationInfo.durationUnit);
                    const endTime = startTime + durationMs;
                    
                    // Create investment ID
                    const investmentId = `${transactionDate.getTime()}_${assetKey}_${amount}`;
                    
                    // Check if this investment already exists
                    if (existingIds.includes(investmentId)) {
                        return;
                    }
                    
                    // Calculate current progress
                    const now = Date.now();
                    const isCompleted = now >= endTime;
                    const progress = isCompleted ? 100 : Math.min(((now - startTime) / durationMs) * 100, 100);
                    
                    const investment = {
                        id: investmentId,
                        transactionId: transaction.id || Date.now(),
                        assetKey: assetKey,
                        planInfo: planInfo,
                        amount: amount,
                        startTime: transactionDate,
                        endTime: new Date(endTime),
                        duration: durationInfo.duration,
                        durationUnit: durationInfo.durationUnit,
                        roi: durationInfo.roi,
                        status: isCompleted ? 'Completed' : 'Active',
                        progress: progress,
                        returns: (amount * durationInfo.roi) / 100
                    };
                    
                    processedInvestments.push(investment);
                    investmentTransactions.push({
                        ...transaction,
                        parsedDate: transactionDate,
                        investmentId: investmentId
                    });
                }
            });
            
            console.log("Processed investments:", processedInvestments.length);
            
            // Merge with existing investments
            let allInvestments = processedInvestments;
            if (existingData && existingData.investments.length > 0) {
                allInvestments = [...existingData.investments, ...processedInvestments];
            }
            
            // Save to persistent storage
            saveInvestmentData(email, allInvestments, investmentTransactions);
            
            // Cache for quick access
            cacheInvestmentData(email, {
                investments: allInvestments,
                transactions: investmentTransactions
            });
            
            if (allInvestments.length === 0) {
                displayNoInvestments();
                return;
            }
            
            // Display investments
            displayInvestments(allInvestments);
            
            // Display transactions
            displayInvestmentTransactions(investmentTransactions);
            
            // Update summary statistics
            updateInvestmentStats(allInvestments);
            
            // Initialize charts
            updateChartsWithData(allInvestments);
            
        } catch (err) {
            console.error("Error loading fresh investment data:", err);
            displayNoInvestments();
        }
    }
    
    function displayInvestments(investments) {
        const container = document.getElementById('investmentContainer');
        const currencySymbol = getCurrentCurrencySymbol();
        
        if (!investments || investments.length === 0) {
            displayNoInvestments();
            return;
        }
        
        // Sort by end time (soonest first)
        investments.sort((a, b) => new Date(a.endTime) - new Date(b.endTime));
        
        container.innerHTML = '';
        
        investments.forEach((investment, index) => {
            const plan = investment.planInfo;
            const now = new Date();
            const startTime = new Date(investment.startTime);
            const endTime = new Date(investment.endTime);
            
            // Calculate time remaining
            const timeRemainingMs = Math.max(0, endTime - now);
            const timeRemaining = formatTimeRemaining(timeRemainingMs);
            
            // Calculate progress
            const totalDuration = endTime - startTime;
            const elapsed = Math.max(0, now - startTime);
            const progress = Math.min((elapsed / totalDuration) * 100, 100);
            
            // Calculate returns
            const returns = investment.returns;
            const dailyReturn = returns / Math.max(investment.duration, 1);
            
            // Format dates
            const formattedStartDate = startTime.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
            
            const formattedStartTime = startTime.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const investmentCard = document.createElement('div');
            investmentCard.className = 'investment-card p-6 mb-4';
            investmentCard.dataset.type = plan.type;
            investmentCard.dataset.id = investment.id;
            
            investmentCard.innerHTML = `
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                    <div class="mb-4 md:mb-0">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="text-2xl">${getIconForType(plan.type)}</span>
                            <div>
                                <div class="flex items-center gap-2">
                                    <span class="${plan.badge} investment-badge">${plan.type.toUpperCase()}</span>
                                    <span class="text-sm text-gray-400">#${index + 1}</span>
                                    <span class="text-xs px-2 py-1 rounded-full ${investment.status === 'Completed' ? 'status-completed' : 'status-active'}">
                                        ${investment.status}
                                    </span>
                                </div>
                                <h3 class="text-lg font-semibold text-white mt-1">${plan.asset}</h3>
                                <p class="text-sm text-gray-400">ROI: ${investment.roi}% ‚Ä¢ ${formatDuration(investment.duration, investment.durationUnit)}</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
                            <div>
                                <p class="text-xs text-gray-500">Amount</p>
                                <p class="text-sm font-semibold text-white" data-amount="${investment.amount}">${currencySymbol}${investment.amount.toFixed(2)}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">Daily</p>
                                <p class="text-sm font-semibold text-green-400" data-amount="${dailyReturn}">+${currencySymbol}${dailyReturn.toFixed(2)}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">Total Returns</p>
                                <p class="text-sm font-semibold text-cyan-400" data-amount="${returns}">${currencySymbol}${returns.toFixed(2)}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">Time Remaining</p>
                                <span class="text-xs time-remaining">${timeRemaining}</span>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-400">Progress</span>
                                <span class="text-white">${progress.toFixed(1)}%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-2.5">
                                <div class="progress-bar h-2.5 rounded-full" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        
                        <div class="text-xs text-gray-500 mt-2">
                            Started: ${formattedStartDate} ${formattedStartTime}
                        </div>
                    </div>
                    
                    <div class="md:text-right">
                        <div class="mb-2">
                            <span class="text-gray-400">Ends In</span>
                            <p class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-cyan-400 bg-clip-text text-transparent">${timeRemaining}</p>
                        </div>
                        <div class="text-sm text-gray-400">
                            Ends: ${endTime.toLocaleDateString('en-US', {
                                month: 'short',
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(investmentCard);
        });
        
        // Update currency display after cards are created
        updateCurrencyDisplay();
    }
    
    function displayInvestmentTransactions(transactions) {
        const container = document.getElementById('investmentTransactionsList');
        const currencySymbol = getCurrentCurrencySymbol();
        
        if (!transactions || transactions.length === 0) {
            container.innerHTML = `
                <tr>
                    <td colspan="8" class="text-center py-12">
                        <p class="text-gray-500">No investment transactions found</p>
                    </td>
                </tr>
            `;
            return;
        }
        
        // Sort by date (newest first)
        transactions.sort((a, b) => {
            const dateA = a.parsedDate || new Date(a.timestamp) || new Date(a.date);
            const dateB = b.parsedDate || new Date(b.timestamp) || new Date(b.date);
            return dateB - dateA;
        });
        
        container.innerHTML = '';
        
        transactions.slice(0, 20).forEach((transaction, index) => {
            const row = document.createElement('tr');
            row.className = 'border-b border-gray-800 hover:bg-gray-800/50';
            
            const transactionDate = transaction.parsedDate || new Date(transaction.timestamp) || new Date(transaction.date);
            const formattedDate = transactionDate.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const amount = parseFloat(transaction.amount) || 0;
            const method = (transaction.method || '').toLowerCase();
            
            // Parse duration and asset
            const durationInfo = parseDurationFromMethod(method);
            const assetKey = parseAssetFromMethod(method);
            const plan = INVESTMENT_PLANS[assetKey] || {
                type: 'crypto',
                roi: durationInfo.roi,
                asset: 'Investment',
                badge: 'badge-crypto'
            };
            
            // Calculate returns
            const returns = (amount * durationInfo.roi) / 100;
            
            // Determine status based on end time
            const startTime = transactionDate.getTime();
            const durationMs = durationToMs(durationInfo.duration, durationInfo.durationUnit);
            const endTime = startTime + durationMs;
            const now = Date.now();
            const isCompleted = now >= endTime;
            
            row.innerHTML = `
                <td class="py-3 px-4 text-sm text-gray-300">${formattedDate}</td>
                <td class="py-3 px-4">
                    <span class="${plan.badge} investment-badge text-xs">${plan.type.toUpperCase()}</span>
                </td>
                <td class="py-3 px-4 text-sm text-white font-medium">${plan.asset}</td>
                <td class="py-3 px-4 text-sm text-gray-300">${formatDuration(durationInfo.duration, durationInfo.durationUnit)} Plan</td>
                <td class="py-3 px-4 text-sm text-green-400 font-semibold" data-amount="${amount}">${currencySymbol}${amount.toFixed(2)}</td>
                <td class="py-3 px-4 text-sm text-gray-300">${formatDuration(durationInfo.duration, durationInfo.durationUnit)}</td>
                <td class="py-3 px-4 text-sm">
                    <span class="px-2 py-1 rounded-full text-xs ${isCompleted ? 'status-completed' : 'status-active'}">
                        ${isCompleted ? 'Completed' : 'Active'}
                    </span>
                </td>
                <td class="py-3 px-4 text-sm text-yellow-400 font-semibold" data-amount="${returns}">${currencySymbol}${returns.toFixed(2)}</td>
            `;
            
            container.appendChild(row);
        });
        
        // Update currency display after table is created
        updateCurrencyDisplay();
    }
    
    function updateInvestmentStats(investments) {
        const currencySymbol = getCurrentCurrencySymbol();
        
        let totalInvestment = 0;
        let totalReturns = 0;
        let activePlans = 0;
        let bestPerformer = { name: '-', returns: 0 };
        let portfolioValue = 0;
        
        investments.forEach(investment => {
            totalInvestment += investment.amount;
            totalReturns += investment.returns;
            portfolioValue += investment.amount + investment.returns;
            
            if (investment.status === 'Active') {
                activePlans++;
            }
            
            if (investment.returns > bestPerformer.returns) {
                bestPerformer = {
                    name: investment.planInfo.asset,
                    returns: investment.returns
                };
            }
        });
        
        const growthPercentage = totalInvestment > 0 ? (totalReturns / totalInvestment) * 100 : 0;
        const dailyAverage = totalReturns > 0 ? totalReturns / 30 : 0;
        
        // Update with data attributes for currency conversion
        const totalInvestmentEl = document.getElementById('totalInvestment');
        totalInvestmentEl.innerHTML = `<span class="currency-symbol">${currencySymbol}</span>${totalInvestment.toFixed(2)}`;
        totalInvestmentEl.setAttribute('data-amount', totalInvestment);
        
        const totalReturnsEl = document.getElementById('totalReturns');
        totalReturnsEl.innerHTML = `<span class="currency-symbol">${currencySymbol}</span>${totalReturns.toFixed(2)}`;
        totalReturnsEl.setAttribute('data-amount', totalReturns);
        
        const portfolioValueEl = document.getElementById('portfolioValue');
        portfolioValueEl.innerHTML = `<span class="currency-symbol">${currencySymbol}</span>${portfolioValue.toFixed(2)}`;
        portfolioValueEl.setAttribute('data-amount', portfolioValue);
        
        document.getElementById('growthPercentage').textContent = `${growthPercentage.toFixed(1)}%`;
        document.getElementById('activePlansCount').textContent = activePlans;
        
        const dailyAverageEl = document.getElementById('dailyAverage');
        dailyAverageEl.innerHTML = `<span class="currency-symbol">${currencySymbol}</span>${dailyAverage.toFixed(2)}`;
        dailyAverageEl.setAttribute('data-amount', dailyAverage);
        
        document.getElementById('bestPerformer').textContent = bestPerformer.name;
        
        const bestPerformerReturnsEl = document.getElementById('bestPerformerReturns');
        bestPerformerReturnsEl.innerHTML = `<span class="currency-symbol">${currencySymbol}</span>${bestPerformer.returns.toFixed(2)}`;
        bestPerformerReturnsEl.setAttribute('data-amount', bestPerformer.returns);
    }
    
    function displayNoInvestments() {
        const container = document.getElementById('investmentContainer');
        container.innerHTML = `
            <div class="investment-card p-6 text-center">
                <div class="text-5xl mb-4">üìà</div>
                <h3 class="text-xl font-semibold text-white mb-3">No Active Investments</h3>
                <p class="text-gray-400 mb-6">Start investing to track your portfolio performance here</p>
                <div class="flex gap-4 justify-center flex-wrap">
                    <a href="cryptocurrencies.html" class="text-sm text-orange-400 hover:text-orange-300">Invest in Crypto</a>
                    <a href="stocks.html" class="text-sm text-blue-400 hover:text-blue-300">Invest in Stocks</a>
                    <a href="etfs.html" class="text-sm text-green-400 hover:text-green-300">Invest in ETFs</a>
                    <a href="precious-metals.html" class="text-sm text-yellow-400 hover:text-yellow-300">Invest in Metals</a>
                </div>
            </div>
        `;
        
        const currencySymbol = getCurrentCurrencySymbol();
        
        const totalInvestmentEl = document.getElementById('totalInvestment');
        totalInvestmentEl.innerHTML = `<span class="currency-symbol">${currencySymbol}</span>0.00`;
        totalInvestmentEl.setAttribute('data-amount', '0');
        
        const totalReturnsEl = document.getElementById('totalReturns');
        totalReturnsEl.innerHTML = `<span class="currency-symbol">${currencySymbol}</span>0.00`;
        totalReturnsEl.setAttribute('data-amount', '0');
        
        const portfolioValueEl = document.getElementById('portfolioValue');
        portfolioValueEl.innerHTML = `<span class="currency-symbol">${currencySymbol}</span>0.00`;
        portfolioValueEl.setAttribute('data-amount', '0');
        
        document.getElementById('growthPercentage').textContent = '0%';
        document.getElementById('activePlansCount').textContent = '0';
        
        const dailyAverageEl = document.getElementById('dailyAverage');
        dailyAverageEl.innerHTML = `<span class="currency-symbol">${currencySymbol}</span>0.00`;
        dailyAverageEl.setAttribute('data-amount', '0');
        
        document.getElementById('bestPerformer').textContent = '-';
        
        const bestPerformerReturnsEl = document.getElementById('bestPerformerReturns');
        bestPerformerReturnsEl.innerHTML = `<span class="currency-symbol">${currencySymbol}</span>0.00`;
        bestPerformerReturnsEl.setAttribute('data-amount', '0');
        
        const containerTable = document.getElementById('investmentTransactionsList');
        containerTable.innerHTML = `
            <tr>
                <td colspan="8" class="text-center py-12">
                    <p class="text-gray-500">No investment transactions found</p>
                </td>
            </tr>
        `;
        
        initializeEmptyCharts();
    }
    
    function initializeEmptyCharts() {
        if (performanceChart) performanceChart.destroy();
        if (distributionChart) distributionChart.destroy();
        if (candlestickChart) candlestickChart.destroy();
        
        const currencySymbol = getCurrentCurrencySymbol();
        
        // Empty performance chart
        const performanceCtx = document.getElementById('performanceChart').getContext('2d');
        performanceChart = new Chart(performanceCtx, {
            type: 'line',
            data: {
                labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'],
                datasets: [{
                    label: 'Portfolio Value',
                    data: [1000, 1050, 1100, 1150, 1200, 1250, 1300],
                    borderColor: '#8b5cf6',
                    backgroundColor: 'rgba(139, 92, 246, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { labels: { color: '#9ca3af' } },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${currencySymbol}${context.raw}`;
                            }
                        }
                    }
                },
                scales: {
                    x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#9ca3af' } },
                    y: { 
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { 
                            color: '#9ca3af',
                            callback: function(value) {
                                return `${currencySymbol}${value}`;
                            }
                        }
                    }
                }
            }
        });
        
        // Empty distribution chart
        const distributionCtx = document.getElementById('distributionChart').getContext('2d');
        distributionChart = new Chart(distributionCtx, {
            type: 'doughnut',
            data: {
                labels: ['Crypto', 'Stocks', 'ETFs', 'Metals'],
                datasets: [{
                    data: [25, 25, 25, 25],
                    backgroundColor: ['#f59e0b', '#3b82f6', '#10b981', '#fbbf24'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'right', labels: { color: '#9ca3af', padding: 20 } },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.raw}%`;
                            }
                        }
                    }
                }
            }
        });
        
        // Empty candlestick chart
        const candlestickCtx = document.getElementById('candlestickChart').getContext('2d');
        candlestickChart = new Chart(candlestickCtx, {
            type: 'candlestick',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Market Index',
                    data: [
                        { o: 100, h: 105, l: 95, c: 100 },
                        { o: 100, h: 105, l: 95, c: 100 },
                        { o: 100, h: 105, l: 95, c: 100 },
                        { o: 100, h: 105, l: 95, c: 100 },
                        { o: 100, h: 105, l: 95, c: 100 },
                        { o: 100, h: 105, l: 95, c: 100 },
                        { o: 100, h: 105, l: 95, c: 100 }
                    ],
                    color: { up: '#10b981', down: '#ef4444', unchanged: '#6b7280' }
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#9ca3af' } },
                    y: { 
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { 
                            color: '#9ca3af',
                            callback: function(value) {
                                return `${currencySymbol}${value}`;
                            }
                        }
                    }
                }
            }
        });
    }
    
    function updateChartsWithData(investments) {
        if (performanceChart) performanceChart.destroy();
        if (distributionChart) distributionChart.destroy();
        
        const currencySymbol = getCurrentCurrencySymbol();
        
        // Update performance chart with real data
        const performanceCtx = document.getElementById('performanceChart').getContext('2d');
        
        // Calculate portfolio value over last 7 days
        const labels = [];
        const data = [];
        
        // Get total portfolio value
        let totalPortfolioValue = 0;
        investments.forEach(investment => {
            totalPortfolioValue += investment.amount + investment.returns;
        });
        
        // Create projection for next 7 days (assuming 5% daily growth)
        for (let i = 0; i < 7; i++) {
            labels.push(`Day ${i + 1}`);
            const growthFactor = 1 + (0.05 * i);
            data.push(Math.round(totalPortfolioValue * growthFactor));
        }
        
        performanceChart = new Chart(performanceCtx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Portfolio Value',
                    data: data,
                    borderColor: '#8b5cf6',
                    backgroundColor: 'rgba(139, 92, 246, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { labels: { color: '#9ca3af' } },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${currencySymbol}${context.raw.toLocaleString()}`;
                            }
                        }
                    }
                },
                scales: {
                    x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#9ca3af' } },
                    y: { 
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { 
                            color: '#9ca3af',
                            callback: function(value) {
                                return `${currencySymbol}${value.toLocaleString()}`;
                            }
                        }
                    }
                }
            }
        });
        
        // Update distribution chart with real data
        const distributionCtx = document.getElementById('distributionChart').getContext('2d');
        
        const typeData = {};
        const typeColors = {};
        const typeLabels = [];
        const typeValues = [];
        const typeColorMap = {
            'crypto': '#f59e0b',
            'stock': '#3b82f6',
            'etf': '#10b981',
            'metal': '#fbbf24'
        };
        
        investments.forEach(investment => {
            const type = investment.planInfo.type;
            if (!typeData[type]) {
                typeData[type] = 0;
            }
            typeData[type] += investment.amount;
            typeColors[type] = investment.planInfo.color || typeColorMap[type] || '#8b5cf6';
        });
        
        for (const [type, value] of Object.entries(typeData)) {
            typeLabels.push(type.charAt(0).toUpperCase() + type.slice(1));
            typeValues.push(value);
        }
        
        if (typeValues.length === 0) {
            typeLabels.push('Crypto', 'Stocks', 'ETFs', 'Metals');
            typeValues.push(25, 25, 25, 25);
        }
        
        distributionChart = new Chart(distributionCtx, {
            type: 'doughnut',
            data: {
                labels: typeLabels,
                datasets: [{
                    data: typeValues,
                    backgroundColor: typeLabels.map(label => {
                        const type = label.toLowerCase();
                        return typeColors[type] || typeColorMap[type] || '#8b5cf6';
                    }),
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'right', labels: { color: '#9ca3af', padding: 20 } },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const value = context.raw;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((value / total) * 100).toFixed(1);
                                return `${context.label}: ${currencySymbol}${value.toLocaleString()} (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });
    }
    
    function refreshInvestments() {
        const userEmail = localStorage.getItem("v0trade_user_email");
        if (!userEmail) return;
        
        const container = document.getElementById('investmentContainer');
        container.innerHTML = `
            <div class="investment-card p-6 text-center">
                <div class="flex flex-col items-center justify-center">
                    <svg class="animate-spin h-12 w-12 text-purple-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="text-gray-400">Refreshing investment data...</p>
                </div>
            </div>
        `;
        
        // Clear cache and reload fresh data
        localStorage.removeItem(`${INVESTMENT_CACHE_KEY}_${userEmail}`);
        
        setTimeout(() => {
            loadFreshInvestmentData(userEmail);
            
            const refreshBtn = document.querySelector('button[onclick="refreshInvestments()"]');
            const originalText = refreshBtn.innerHTML;
            refreshBtn.innerHTML = '‚úì Refreshed';
            refreshBtn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
            
            setTimeout(() => {
                refreshBtn.innerHTML = originalText;
                refreshBtn.style.background = '';
            }, 2000);
        }, 1000);
    }
    
    function filterInvestments(type) {
        const cards = document.querySelectorAll('.investment-card');
        const buttons = document.querySelectorAll('.filter-btn');
        
        buttons.forEach(btn => {
            btn.classList.remove('bg-purple-500/20', 'text-purple-400', 'border-purple-500/30');
            btn.classList.add('bg-slate-800', 'text-gray-400', 'border-slate-700');
        });
        
        event.target.classList.remove('bg-slate-800', 'text-gray-400', 'border-slate-700');
        event.target.classList.add('bg-purple-500/20', 'text-purple-400', 'border-purple-500/30');
        
        if (type === 'all') {
            cards.forEach(card => card.style.display = 'block');
        } else {
            cards.forEach(card => {
                card.style.display = card.dataset.type === type ? 'block' : 'none';
            });
        }
    }
    
    function getIconForType(type) {
        switch(type) {
            case 'crypto': return '‚Çø';
            case 'stock': return 'üìä';
            case 'etf': return 'üìà';
            case 'metal': return 'üíé';
            default: return 'üí∞';
        }
    }
    
    // Auto-update investments every minute
    setInterval(() => {
        const userEmail = localStorage.getItem("v0trade_user_email");
        if (userEmail) {
            const storedData = getStoredInvestmentData(userEmail);
            if (storedData && storedData.investments.length > 0) {
                // Update progress and status
                const updatedInvestments = storedData.investments.map(investment => {
                    const now = new Date();
                    const startTime = new Date(investment.startTime);
                    const endTime = new Date(investment.endTime);
                    
                    if (now >= endTime && investment.status !== 'Completed') {
                        investment.status = 'Completed';
                        investment.progress = 100;
                    } else if (now < endTime) {
                        const totalDuration = endTime - startTime;
                        const elapsed = now - startTime;
                        investment.progress = Math.min((elapsed / totalDuration) * 100, 100);
                    }
                    
                    return investment;
                });
                
                // Save updated data
                saveInvestmentData(userEmail, updatedInvestments, storedData.transactions);
                
                // Update display if we're on the investment tracks page
                if (window.location.pathname.includes('investment-tracks')) {
                    displayInvestments(updatedInvestments);
                    updateInvestmentStats(updatedInvestments);
                }
            }
        }
    }, 60000); // Update every minute
    
    // Auto-refresh when returning to the page
    window.addEventListener('focus', () => {
        const userEmail = localStorage.getItem("v0trade_user_email");
        if (userEmail) {
            console.log("Page focused, refreshing investment data...");
            loadInvestmentData(userEmail);
        }
    });
</script>
</body>
</html>
